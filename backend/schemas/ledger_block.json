{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ledger Block",
  "description": "Schema for transparency ledger blocks in OQT-1.0 pipeline",
  "type": "object",
  "required": ["block_id", "timestamp", "previous_hash", "current_hash", "event_type", "data"],
  "properties": {
    "block_id": {
      "type": "number",
      "minimum": 0,
      "description": "Sequential block identifier (0 is genesis block)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of block creation"
    },
    "previous_hash": {
      "type": "string",
      "description": "Hash of the previous block (null for genesis block)"
    },
    "current_hash": {
      "type": "string",
      "description": "Hash of this block's data"
    },
    "event_type": {
      "type": "string",
      "enum": ["training", "update", "audit", "review", "data_collection", "change_detection", "genesis"],
      "description": "Type of event recorded in this block"
    },
    "data": {
      "type": "object",
      "description": "Event-specific data",
      "properties": {
        "model_version": {
          "type": "string",
          "description": "Model version affected by this event"
        },
        "training_samples": {
          "type": "number",
          "minimum": 0,
          "description": "Number of training samples involved"
        },
        "fairness_metrics": {
          "type": "object",
          "description": "Fairness metrics at this point"
        },
        "bias_metrics": {
          "type": "object",
          "description": "Bias metrics at this point"
        },
        "provenance": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "object"
            }
          ],
          "description": "Data source provenance information or metadata object"
        },
        "changes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string"
              },
              "old_value": {},
              "new_value": {}
            }
          },
          "description": "Changes made in this event"
        },
        "question_hash": {
          "type": "string",
          "description": "SHA-256 hash of the question (for change_detection events)"
        },
        "sentiment_shift": {
          "type": "string",
          "description": "Sentiment change description (for change_detection events)"
        },
        "ideology_shift": {
          "type": "string",
          "description": "Ideological shift description (for change_detection events)"
        },
        "text_similarity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Text similarity score 0-1 (for change_detection events)"
        },
        "severity_index": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Change severity index 0-1 (for change_detection events)"
        },
        "consensus_shift": {
          "type": "boolean",
          "description": "Whether consensus shifted across models (for change_detection events)"
        },
        "bias_drift": {
          "type": "string",
          "description": "Description of bias drift (for change_detection events)"
        },
        "explainability_delta": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of feature changes (for change_detection events)"
        },
        "dominant_themes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of dominant themes in response (for change_detection events)"
        },
        "ethical_tag": {
          "type": "string",
          "description": "Ethical impact tag (for change_detection events)"
        },
        "version_shift": {
          "type": "string",
          "description": "Description of version change (for change_detection events)"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the event"
        }
      }
    },
    "signatures": {
      "type": "object",
      "description": "Cryptographic signatures for verification",
      "properties": {
        "data_hash": {
          "type": "string",
          "description": "Hash of the data field for integrity verification"
        },
        "validator": {
          "type": "string",
          "description": "Identifier of the validator/creator of this block"
        }
      }
    }
  }
}
